---
layout: post
title: Copy
categories: [ios]
tags: [ios]
description: Copy关键字
---

<h3>retain和copy的区别</h3>

copy:建立一个索引计数为1的对象，然后释放旧对象

retain:释放旧的对象，将旧对象的值赋予输入对象，再提高输入对象的索引计数为1

例：
一个NSString 对象地址为0X1111 内容为@"abc";
Copy到另一个NSString 之后，地址为0x2222，内容相同，新的对象retain为1，旧对象没有变化
retain到另一个NSString之后，地址相同，内容相同，这个对象的retain值+1.
也就是说，retain是指针拷贝，copy是内容拷贝。


<h3>NSString 属性什么时候用copy,什么时候用strong?</h3>

<p>
当源字符串是NSString时，由于字符串是不可变的，所以，不管是strong还是copy属性的对象，都是指向源对象，copy操作只是做了次浅拷贝。
</p>
<p>
当源字符串是NSMutableString时，strong属性只是增加了源字符串的引用计数，而copy属性则是对源字符串做了次深拷贝，产生一个新的对象，且copy属性对象指向这个新的对象。
</p>
<p>
这里还有一个性能问题，即在源字符串是NSMutableString，strong是单纯的增加对象的引用计数，而copy操作是执行了一次深拷贝，所以性能上会有所差异。而如果源字符串是NSString时，则没有这个问题。
</p>

{% highlight ruby %}

p str 会打印对象本身的内存地址和对象内容
(lldb) p str
(NSString *) $0 = 0x7fdad3f0ff60 @"aab"

po &str 则打印的是引用对象的指针所在的地址

{% endhighlight %}

<h3>集合的深复制与浅复制</h3>



